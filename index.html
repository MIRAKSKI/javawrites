<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تعديل ملف JSON في Google Drive</title>
</head>
<body>
    <h1>إرسال بيانات جديدة إلى ملف data.json</h1>

    <label for="newData">أدخل قيمة جديدة (مثل اسم):</label><br>
    <input type="text" id="newData" value="" placeholder="تجربة إضافة جديدة"><br><br>

    <button onclick="sendData()">إرسال وتعديل الملف</button>

    <pre id="response"></pre>

    <script>
        // *** استبدل هذا برابط تطبيق الويب الذي نسخته من Apps Script ***
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzS70T4yK7YXviM6DU25QwpWvqTPdTri88uFgX0tdANURBcTm8A86G9j72oridJtzyi/exec";

        async function sendData() {
            const dataElement = document.getElementById('newData');
            const responseElement = document.getElementById('response');

            responseElement.textContent = '... جارٍ الإرسال، انتظر رجاءً ...';

            // 1. تجهيز البيانات للإرسال (تأكد أن تتطابق مع التنسيق الذي تتوقعه دالة doPost)
            const payload = {
                newData: dataElement.value,
                timestamp: new Date().toLocaleString('ar-EG')
            };

            try {
                // 2. إرسال طلب POST إلى سكريبت Apps Script
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    // Apps Script يتوقع البيانات في هذا التنسيق
                    body: JSON.stringify(payload),
                    headers: {
                        'Content-Type': 'text/plain' // مهم جداً
                    }
                });

                // 3. معالجة الاستجابة
                const result = await response.json();

                if (result.status === 'success') {
                    responseElement.textContent = `✅ نجح التعديل: ${result.message}\n\nمحتوى الملف بعد التعديل:\n${JSON.stringify(result.content, null, 2)}`;
                } else {
                    responseElement.textContent = `❌ فشل التعديل: ${result.message}`;
                }

            } catch (error) {
                responseElement.textContent = `⚠️ حدث خطأ في الاتصال: ${error.message}`;
            }
        }
    </script>
</body>
</html>
